---
import BlogPost from '../../layouts/BlogPost.astro';
export const prerender = true;


import {gql, GraphQLClient} from 'graphql-request';

  const client = new GraphQLClient('https://wordpress-1324799-4844326.cloudwaysapps.com/graphql');

const query = gql`
	query {
		posts {
			nodes {
				title
				excerpt
				date
				modified
				slug
				featuredImage {
					node {
						sourceUrl
					}
				}
				content
			}
		}
	}
`;

const response = await client.request(query);

const posts = response.posts.nodes.map((post : any) => ({
	title: post.title,
	slug: post.slug,
	description: post.excerpt,
	pubDate: post.date,
	updatedDate: post.modified,
	heroImage: post.featuredImage.node.sourceUrl,
	content: post.content
}));



export async function getStaticPaths() {
	 const res = await fetch('https://wordpress-1324799-4844326.cloudwaysapps.com/wp-json/wp/v2/posts');	
	 const posts = await res.json();
	 return posts.map((post : any) => ({
		params: {
			slug: post.slug
		},
		props : {
			title: post.title.rendered,
			description: post.excerpt.rendered,
			pubDate: post.date,
			updatedDate: post.modified,
			heroImage: post.featured_media,
			content: post.content.rendered
		}
	 }));
};

type Props = {
	title: string;
	description: string;
	pubDate: string;
	updatedDate: string;
	heroImage: string;
	content: string;
}

const post = Astro.props;

---

<BlogPost {...post}>
	<Fragment set:html={post.content} />
</BlogPost>


